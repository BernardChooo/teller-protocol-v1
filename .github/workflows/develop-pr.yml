name: Test Changed or New Files under test/

on:
  pull_request:
    branches:
      - develop

jobs:
  test:
    name: Build Project
    runs-on: ubuntu-latest
    continue-on-error: true
    env:
      ALCHEMY_KEY: ${{ secrets.ALCHEMY_KEY }}
      INFURA_KEY: ${{ secrets.INFURA_KEY }}
      ETHERSCAN_API_KEY: ${{ secrets.ETHERSCAN_API_KEY }}
      GAS_PRICE_GWEI_KEY: 20
      GAS_WEI_KEY: 2500000
      MNEMONIC_KEY: ${{ secrets.MNEMONIC_KEY }}
      ADDRESS_COUNT_KEY: 10
      DEFAULT_ADDRESS_INDEX_KEY: 0
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v1
        with:
          node-version: '14.15.x'
      - id: files
        name: Get List of Changed Files
        uses: jitterbit/get-changed-files@v1
        continue-on-error: true
      - name: Main
        env:
          CHANGED_FILES: "${{ steps.files.outputs.added_modified  }}"
        run: |
          CHANGED_TEST_FILES=`echo "$CHANGED_FILES" | tr " " '\n' | grep 'test/' | tr '\n' " "`
          if [ "$CHANGED_TEST_FILES" ]; then yarn && yarn compile && yarn test $CHANGED_TEST_FILES; fi
